function onResize(){var t=document.getElementById("gameCanvas"),e=window.innerWidth/t.width,i=window.innerHeight/t.height,n=0|Math.min(e,i);n=0>=n?1:n;var s=[t.width*n,t.height*n],h=this.offset=[(window.innerWidth-s[0])/2,(window.innerHeight-s[1])/2],a=document.getElementById("stage"),o="translate("+h[0]+"px, "+h[1]+"px) scale("+n+")";a.style.transform=o,a.style.webkitTransform=o}var Input;!function(t){var e;!function(t){function e(t){return h[t]}function i(t){var e=o[t];return o[t]=!1,e}function n(t){var e=t.which;h[e]=!0,a[e]&&(o[e]=!0),a[e]=!1}function s(t){var e=t.which;h[e]=!1,a[e]=!0}!function(t){t[t.A=65]="A",t[t.D=68]="D",t[t.W=87]="W",t[t.S=83]="S",t[t.LEFT=37]="LEFT",t[t.RIGHT=39]="RIGHT",t[t.UP=38]="UP",t[t.DOWN=40]="DOWN",t[t.ENTER=13]="ENTER",t[t.SPACE=32]="SPACE"}(t.KEY||(t.KEY={}));for(var h=(t.KEY,[]),a=[],o=[],r=0;256>r;r++)a[r]=!0;t.isDown=e,t.wasDown=i,t.keyDown=n,t.keyUp=s}(e=t.KB||(t.KB={}))}(Input||(Input={}));var Entity=function(){function t(){}return t}(),Item=function(){function t(){}return t}(),Cell=function(){function t(t,e,i){void 0===t&&(t=0),void 0===e&&(e=[]),void 0===i&&(i=[]),this.tileID=t,this.entities=e,this.items=i}return t}(),Level=function(){function t(t,e){this.cells=[],this.width=t,this.height=e;for(var i=0;i<this.width;i++)for(var n=0;n<this.height;n++)void 0===this.cells[i]&&(this.cells[i]=[]),this.cells[i][n]=new Cell}return t.prototype.getWidth=function(){return this.width},t.prototype.getHeight=function(){return this.height},t}(),Game=function(){function t(t){this.change=!0,this.redraw=!0,this.clearScreen=!0,this.then=performance.now(),this.timePaused=0,this.deltaPaused=0,console.log("Setting up screen"),this.screen=t,this.ctx=t.getContext("2d"),this.ctx.mozImageSmoothingEnabled=!1,this.ctx.imageSmoothingEnabled=!1}return t.prototype.init=function(){console.log("Initializing..."),this.level=new Level(10,10),console.log(this.level.cells),this.state="MainMenu"},t.prototype.update=function(t){switch(this.state){case"MainMenu":this.state="Game";break;case"Game":this.deltaPaused>0&&(t-=this.deltaPaused,0>t&&(t=0),this.deltaPaused=0);break;case"GamePause":break;case"GameOver":this.state="MainMenu"}},t.prototype.draw=function(){switch(this.state){case"MainMenu":break;case"Game":this.clearScreen&&(this.ctx.clearRect(0,0,this.screen.width,this.screen.height),this.ctx.fillStyle="#bbb",this.ctx.fillRect(0,360,640,this.screen.height),this.ctx.fillStyle="#ddd",this.ctx.fillRect(640,0,this.screen.height,this.screen.width),this.clearScreen=!1);break;case"GamePause":this.change&&(this.ctx.globalAlpha=.7,this.ctx.fillStyle="black",this.ctx.fillRect(0,0,this.screen.width,this.screen.height),this.ctx.globalAlpha=1,this.ctx.font="18px Verdana",this.ctx.textAlign="center",this.ctx.fillStyle="white",this.ctx.fillText("PAUSED",this.screen.width/2|0,this.screen.height/2|0),this.change=!1);break;case"GameOver":}},t.prototype.render=function(){var t=performance.now(),e=t-this.then;this.then=t,this.update(e),this.draw(),this._loopHandle=window.requestAnimationFrame(this.render.bind(this))},t.prototype.run=function(){console.log("Game running"),this._loopHandle=window.requestAnimationFrame(this.render.bind(this))},t.prototype.stop=function(){console.log("Game stopped"),window.cancelAnimationFrame(this._loopHandle)},t.prototype.pause=function(){"Game"===this.state&&(this.state="GamePause",this.change=!0,this.timePaused=performance.now())},t.prototype.unpause=function(){"GamePause"===this.state&&(this.state="Game",this.change=this.clearScreen=!0,this.deltaPaused=performance.now()-this.timePaused,this.timePaused=0)},t}();window.onload=function(){onResize(),window.addEventListener("resize",onResize,!1),window.onkeydown=Input.KB.keyDown,window.onkeyup=Input.KB.keyUp;var t=new Game(document.getElementById("gameCanvas"));t.init(),window.onblur=t.pause.bind(t),window.onfocus=t.unpause.bind(t),t.run()};