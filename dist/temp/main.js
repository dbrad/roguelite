function onResize(){var e=document.getElementById("gameCanvas"),t=window.innerWidth/e.width,n=window.innerHeight/e.height,i=0|Math.min(t,n);i=0>=i?1:i;var a=[e.width*i,e.height*i],s=this.offset=[(window.innerWidth-a[0])/2,(window.innerHeight-a[1])/2],o=document.getElementById("stage"),h="translate("+s[0]+"px, "+s[1]+"px) scale("+i+")";o.style.transform=h,o.style.webkitTransform=h}var Input;!function(e){var t;!function(e){function t(e){return s[e]}function n(e){var t=h[e];return h[e]=!1,t}function i(e){var t=e.which;s[t]=!0,o[t]&&(h[t]=!0),o[t]=!1}function a(e){var t=e.which;s[t]=!1,o[t]=!0}!function(e){e[e.A=65]="A",e[e.D=68]="D",e[e.W=87]="W",e[e.S=83]="S",e[e.LEFT=37]="LEFT",e[e.RIGHT=39]="RIGHT",e[e.UP=38]="UP",e[e.DOWN=40]="DOWN",e[e.ENTER=13]="ENTER",e[e.SPACE=32]="SPACE"}(e.KEY||(e.KEY={}));for(var s=(e.KEY,[]),o=[],h=[],r=0;256>r;r++)o[r]=!0;e.isDown=t,e.wasDown=n,e.keyDown=i,e.keyUp=a}(t=e.KB||(e.KB={}))}(Input||(Input={}));var Game=function(){function e(e){this.change=!0,this.redraw=!0,this.clearScreen=!0,this.then=performance.now(),this.timePaused=0,this.deltaPaused=0,console.log("Setting up screen"),this.screen=e,this.ctx=e.getContext("2d"),this.ctx.mozImageSmoothingEnabled=!1,this.ctx.imageSmoothingEnabled=!1}return e.prototype.init=function(){console.log("Initializing..."),this.state="MainMenu"},e.prototype.update=function(e){switch(this.state){case"MainMenu":this.state="Game";break;case"Game":this.deltaPaused>0&&(e-=this.deltaPaused,0>e&&(e=0),this.deltaPaused=0);break;case"GamePause":break;case"GameOver":this.state="MainMenu"}},e.prototype.draw=function(){switch(this.state){case"MainMenu":break;case"Game":this.clearScreen&&(this.ctx.clearRect(0,0,this.screen.width,this.screen.height),this.clearScreen=!1);break;case"GamePause":this.change&&(this.ctx.globalAlpha=.7,this.ctx.fillStyle="black",this.ctx.fillRect(0,0,this.screen.width,this.screen.height),this.ctx.globalAlpha=1,this.ctx.font="18px Verdana",this.ctx.textAlign="center",this.ctx.fillStyle="white",this.ctx.fillText("PAUSED",this.screen.width/2|0,this.screen.height/2|0),this.change=!1);break;case"GameOver":}},e.prototype.render=function(){var e=performance.now(),t=e-this.then;this.then=e,this.update(t),this.draw(),this._loopHandle=window.requestAnimationFrame(this.render.bind(this))},e.prototype.run=function(){console.log("Game running"),this._loopHandle=window.requestAnimationFrame(this.render.bind(this))},e.prototype.stop=function(){console.log("Game stopped"),window.cancelAnimationFrame(this._loopHandle)},e.prototype.pause=function(){"Game"===this.state&&(this.state="GamePause",this.change=!0,this.timePaused=performance.now())},e.prototype.unpause=function(){"GamePause"===this.state&&(this.state="Game",this.change=this.clearScreen=!0,this.deltaPaused=performance.now()-this.timePaused,this.timePaused=0)},e}();window.onload=function(){onResize(),window.addEventListener("resize",onResize,!1),window.onkeydown=Input.KB.keyDown,window.onkeyup=Input.KB.keyUp;var e=new Game(document.getElementById("gameCanvas"));e.init(),window.onblur=e.pause.bind(e),window.onfocus=e.unpause.bind(e),e.run()};